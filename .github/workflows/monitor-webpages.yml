name: Monitor webpages (Playwright snapshot â†’ GitHub Issue)

on:
  workflow_dispatch: {}

permissions:
  contents: read

jobs:
  monitor:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install Playwright
        run: |
          npm install -D @playwright/test
          npx playwright install --with-deps chromium

      - name: Run Playwright tests (four.meme)
        id: fourmeme
        shell: bash
        run: |
          set -o pipefail
          mkdir -p test-results
          npx playwright test tests/fourmeme.spec.ts 2>&1 | tee test-results/fourmeme.log
        env:
          TARGET_URL: https://four.meme/create-token
        continue-on-error: true

      - name: Run Playwright tests (flap.sh)
        id: flap
        shell: bash
        run: |
          set -o pipefail
          mkdir -p test-results
          npx playwright test tests/flap-launch.spec.ts 2>&1 | tee test-results/flap.log
        continue-on-error: true

      - name: Fail job if changed
        if: steps.fourmeme.outcome == 'failure' || steps.flap.outcome == 'failure'
        run: exit 1
